#+title: Working with OpenSpec with multiple Claude profiles
#+author: HaQadosch
#+date: [2026-02-15 Sun]
#+startup: indent
#+property: header-args :results output
* Book Tracker App — Implementation Plan

** Context

Build a personal "next books to read" app — a todo list for books
where each entry captures not just title/author, but *how you heard
about the book* and *what you expect from it*. These two fields are
the app's differentiator.

Tech stack:
- TanStack Router
- TanStack Query
- Express
- sqlite with Node ~node:sqlite~

all running locally.

** Architecture

#+begin_src shell
book-tracker/
├── server/                  # Express API + SQLite
│   ├── index.ts             # Express server, listens on port 3001
│   └── db.ts                # sqlite3 setup, schema, queries
├── src/                     # React frontend (Vite + TanStack)
│   ├── main.tsx             # App entry, QueryClient provider
│   ├── routeTree.gen.ts     # Auto-generated by TanStack Router plugin
│   ├── routes/
│   │   ├── __root.tsx       # Root layout (nav, shell)
│   │   ├── index.tsx        # Home — book list view
│   │   └── books/
│   │       ├── new.tsx      # Add book form
│   │       └── $bookId.tsx  # Edit/view single book
│   └── components/
│       ├── BookCard.tsx      # Single book display card
│       └── BookForm.tsx      # Reusable form (add + edit)
├── package.json
├── vite.config.ts           # Vite + TanStack Router plugin + proxy to API
└── tsconfig.json
#+end_src


*Data flow:*
React components
→ TanStack Query (useQuery/useMutation)
→ fetch to Express API
→ node-sqlite3
→ SQLite file (*books.db*)

** Database Schema

Single *books* table:

| Column       | Type    | Notes                                     |
|--------------+---------+-------------------------------------------|
| id           | INTEGER | Primary key, autoincrement                |
| title        | TEXT    | Required                                  |
| author       | TEXT    | Required                                  |
| heard_from   | TEXT    | How you heard about it (podcast, friend…) |
| expectations | TEXT    | What you expect to get from reading it    |
| status       | TEXT    | /to-read/, /reading/, /done/              |
| created_at   | TEXT    | ISO timestamp, default now                |

** API Endpoints

| Method | Route          | Action          |
|--------+----------------+-----------------|
| GET    | /api/books     | List all books  |
| GET    | /api/books/:id | Get single book |
| POST   | /api/books     | Create a book   |
| PUT    | /api/books/:id | Update a book   |
| DELETE | /api/books/:id | Delete a book   |

** Implementation Phases

*** Phase 1: Project scaffolding
- Scaffold with ~npx create-tsrouter-app@latest book-tracker --template file-router~
- Add Express + sqlite3 dependencies
- Configure Vite proxy ('/api' → 'localhost:3001')
- Add 'dev' scripts to run both frontend and backend concurrently

*** Phase 2: Database + API
- Create 'server/db.ts' :: initialize SQLite, create *books* table
- Create 'server/index.ts` :: Express server with all 5 CRUD endpoints
- Test API with curl

*** Phase 3: Book list page (Read)
- Wire up `routes/index.tsx` with `useQuery` to fetch and display all books
- Build `BookCard` component showing title, author, status, heard_from, expectations
- Group or filter by status (`to-read` / `reading` / `done`)

*** Phase 4: Add book form (Create)
- Build `BookForm` component with fields: title, author, heard_from, expectations, status
- Wire `routes/books/new.tsx` with `useMutation` to POST, then navigate back to list
- Invalidate `['books']` query on success

*** Phase 5: Edit + Delete (Update/Delete)
- Wire `routes/books/$bookId.tsx` — load book with `useQuery`, edit with `BookForm`
- Add delete button with confirmation
- Both use `useMutation` and invalidate queries on success

*** Phase 6: Polish
- Quick status toggle (click to cycle `to-read` → `reading` → `done`) on the list
- Basic styling (clean, minimal CSS)
- Empty state when no books exist

** How to Run (after implementation)
#+begin_src shell
  # Install dependencies
  npm install

  # Run both frontend and API server
  npm run dev
#+end_src

Frontend on `http://localhost:5173`, API on `http://localhost:3001`.

** Verification

- Add a book via the form → appears in the list
- Edit a book → changes persist after page refresh (proves DB works)
- Delete a book → removed from list
- Status toggle works on the list view
- Refresh browser → all data still there (SQLite persistence)
